<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reality Creation Assessment: A Study in Self-Perception & Personal Architecture</title>
  <link rel="stylesheet" href="css/redesigned-styles.css">
  <!-- Step 1: Inline CSS to Fix Mastery Section Issues -->
<style>
/* Fix the spectrum indicators in "Your Spectrum Map" section */
.spectrum-diagram .relative .h-px.w-full + .relative .absolute.top-0.w-px {
  height: 12px !important; /* Shorter line */
}

.spectrum-diagram .relative .h-px.w-full + .relative .absolute.top-16 {
  top: 12px !important; /* Adjust dot position */
  transform: translate(-50%, 0) !important; /* Center the dot */
  width: 8px !important; /* Slightly larger dot */
  height: 8px !important;
}

/* Add more space between indicator and text */
.spectrum-diagram .text-sm.font-light.text-stone-600 {
  margin-top: 12px;
}

/* Fix alignment of numbered items and "!" icons */
.approach-item .approach-number,
.misalignment-item .misalignment-icon,
.w-6.h-6.rounded-full.bg-amber-100,
.w-6.h-6.rounded-full.bg-stone-100 {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  min-width: 24px !important; /* Ensure consistent width */
}

/* Center the white dot in orange dot for selected answers */
.mt-1.h-4.w-4.shrink-0.rounded-full .flex.h-full.items-center.justify-center .h-1.5.w-1.5.rounded-full.bg-white {
  margin: auto !important;
}

.flex.h-full.items-center.justify-center {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 100% !important;
  height: 100% !important;
}

/* Improve styling of Part 2 Mastery section */
#mastery-questions .question-container {
  display: none; /* Hide all questions initially */
  margin-bottom: 2rem;
}

#mastery-questions .question-container.active {
  display: block; /* Only show active question */
}

#mastery-questions .text-xl.font-light.leading-relaxed.text-stone-700 {
  line-height: 1.6;
  margin-bottom: 2rem;
}

#mastery-questions .ml-12.space-y-4 {
  margin-left: 3rem;
}

/* Improve spacing of option items */
#mastery-questions .group.relative.flex {
  padding: 1.25rem;
  margin-bottom: 0.5rem;
  border-radius: 0.5rem;
}

/* Fix for question numbers in section header */
#section-number {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  width: 100% !important;
  height: 100% !important;
}

/* Fix for specific mastery question numbers in grid */
#mastery-questions .col-span-2 .text-right.text-3xl.font-light.text-stone-800 {
  text-align: center !important;
}

/* Remove background color for iframe embedding */
body, 
.bg-stone-50, 
.introduction-section, 
.assessment-section {
  background-color: transparent !important;
}

/* Make content containers transparent but elements still visible */
.relative.z-20.w-full.max-w-4xl.mx-auto.p-6 {
  background-color: transparent !important;
}

/* Restore floating dust animations */
.background-canvas {
  opacity: 0.7; /* Make particles visible but subtle */
}
</style>

<!-- Step 2: Inline JavaScript to Fix Mastery Section Issues -->
<script>
// Wait for the document to fully load
document.addEventListener('DOMContentLoaded', function() {
  // Fix for Part 2 Mastery section to show one question at a time
  function enhanceMasterySection() {
    // Get questions container
    const questionsContainer = document.getElementById('mastery-questions');
    if (!questionsContainer) return;
    
    // Get all question containers
    const questions = questionsContainer.querySelectorAll('.question-container');
    if (questions.length === 0) return;
    
    // Hide all questions and only show the first one
    questions.forEach((question, index) => {
      question.style.display = index === 0 ? 'block' : 'none';
      question.classList.toggle('active', index === 0);
    });
    
    // Fix the section number in the circle
    const sectionNumber = document.getElementById('section-number');
    if (sectionNumber) {
      sectionNumber.style.display = 'flex';
      sectionNumber.style.justifyContent = 'center';
      sectionNumber.style.alignItems = 'center';
      sectionNumber.style.width = '100%';
      sectionNumber.style.height = '100%';
    }
    
    // Create navigation buttons if they don't exist
    if (!document.getElementById('next-question-btn')) {
      const navFooter = document.querySelector('#part2-section .mt-16.pt-6.border-t.border-stone-200 .flex.items-center.justify-between');
      
      if (navFooter) {
        // Create next question button
        const nextBtn = document.createElement('button');
        nextBtn.id = 'next-question-btn';
        nextBtn.className = 'group flex items-center text-xs font-medium uppercase tracking-widest text-stone-700';
        nextBtn.innerHTML = `
          Next Question
          <span class="ml-4 h-px w-8 bg-stone-500 group-hover:w-12"></span>
        `;
        
        // Create prev question button
        const prevBtn = document.createElement('button');
        prevBtn.id = 'prev-question-btn';
        prevBtn.className = 'group flex items-center text-xs font-medium uppercase tracking-widest text-stone-400 transition-all hover:text-stone-700';
        prevBtn.style.display = 'none';
        prevBtn.innerHTML = `
          <span class="mr-4 h-px w-8 bg-stone-300 transition-all group-hover:w-12 group-hover:bg-stone-500"></span>
          Previous Question
        `;
        
        // Get navigation elements
        const prevSectionBtn = document.getElementById('prev-section-btn');
        const nextSectionBtn = document.getElementById('next-section-btn');
        
        // Hide next section button initially, will show later
        if (nextSectionBtn) nextSectionBtn.style.display = 'none';
        
        // Insert buttons in appropriate places
        if (prevSectionBtn && prevSectionBtn.parentNode) {
          prevSectionBtn.parentNode.insertBefore(prevBtn, prevSectionBtn);
        }
        
        if (nextSectionBtn && nextSectionBtn.parentNode) {
          nextSectionBtn.parentNode.insertBefore(nextBtn, nextSectionBtn);
        }
        
        // Add current question/total questions indicator
        const questionCounter = document.querySelector('#part2-section .text-xs.font-light.text-stone-500');
        if (questionCounter) {
          const currentSection = parseInt(document.getElementById('current-section').textContent) || 1;
          const totalSections = parseInt(document.getElementById('total-sections').textContent) || 3;
          
          questionCounter.innerHTML = `
            Question <span id="current-question">1</span> of <span id="total-questions">${questions.length}</span> • Section ${currentSection} of ${totalSections}
          `;
        }
        
        // Track current question index
        let currentQuestionIndex = 0;
        
        // Next question button handler
        nextBtn.addEventListener('click', function() {
          // Check if current question is answered
          const currentQuestion = questions[currentQuestionIndex];
          const questionId = currentQuestion.dataset.questionId;
          
          if (!window.userResponses.mastery || !window.userResponses.mastery[questionId]) {
            alert('Please answer the current question before proceeding.');
            return;
          }
          
          // Go to next question
          if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            
            // Update display
            questions.forEach((q, idx) => {
              q.style.display = idx === currentQuestionIndex ? 'block' : 'none';
              q.classList.toggle('active', idx === currentQuestionIndex);
            });
            
            // Update question counter
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            
            // Show/hide navigation buttons
            prevBtn.style.display = 'flex';
            
            if (currentQuestionIndex === questions.length - 1) {
              nextBtn.style.display = 'none';
              nextSectionBtn.style.display = 'flex';
            }
          }
        });
        
        // Previous question button handler
        prevBtn.addEventListener('click', function() {
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            
            // Update display
            questions.forEach((q, idx) => {
              q.style.display = idx === currentQuestionIndex ? 'block' : 'none';
              q.classList.toggle('active', idx === currentQuestionIndex);
            });
            
            // Update question counter
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            
            // Show/hide navigation buttons
            if (currentQuestionIndex === 0) {
              prevBtn.style.display = 'none';
            }
            
            nextBtn.style.display = 'flex';
            nextSectionBtn.style.display = 'none';
          }
        });
      }
    }
    
    // Fix alignment of radio buttons and dots
    fixRadioButtonAlignment();
  }
  
  // Fix the radio button alignment and centering
  function fixRadioButtonAlignment() {
    // Fix all radio buttons in mastery options
    const radioButtons = document.querySelectorAll('.group.relative.flex .mt-1.h-4.w-4.shrink-0.rounded-full');
    
    radioButtons.forEach(radio => {
      // Style the radio button
      radio.style.display = 'flex';
      radio.style.alignItems = 'center';
      radio.style.justifyContent = 'center';
      
      // Get the inner dot container if it exists
      const dot = radio.querySelector('.flex.h-full.items-center.justify-center');
      if (dot) {
        dot.style.display = 'flex';
        dot.style.alignItems = 'center';
        dot.style.justifyContent = 'center';
        dot.style.width = '100%';
        dot.style.height = '100%';
        
        // Get the white dot itself
        const whiteDot = dot.querySelector('.h-1\\.5.w-1\\.5.rounded-full.bg-white');
        if (whiteDot) {
          whiteDot.style.margin = 'auto';
        }
      }
    });
  }
  
  // Enhanced background animation
  function enhanceBackgroundAnimation() {
    // Get all canvases
    const canvases = document.querySelectorAll('.background-canvas');
    
    canvases.forEach(canvas => {
      if (!canvas || !canvas.getContext) return;
      
      // Set opacity to make particles visible
      canvas.style.opacity = '0.7';
      
      // Reset any existing canvas animation
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });
  }
  
  // Fix spectrum diagram alignment
  function fixSpectrumDiagramAlignment() {
    const spectrumDiagram = document.getElementById('spectrum-diagram');
    if (!spectrumDiagram) return;
    
    // Get all spectrum items with indicators
    const spectrumItems = spectrumDiagram.querySelectorAll('.relative[style*="margin-left"]');
    
    spectrumItems.forEach(item => {
      // Find and adjust the indicator line
      const indicatorLine = item.querySelector('.absolute.top-0.w-px');
      if (indicatorLine) {
        indicatorLine.style.height = '12px';
        indicatorLine.style.transform = 'translateX(-50%)';
      }
      
      // Find and adjust the indicator dot
      const indicatorDot = item.querySelector('.absolute.top-16');
      if (indicatorDot) {
        indicatorDot.style.top = '12px';
        indicatorDot.style.width = '8px';
        indicatorDot.style.height = '8px';
        indicatorDot.style.transform = 'translateX(-50%)';
      }
    });
    
    // Add more space between indicator and text
    const descriptionTexts = spectrumDiagram.querySelectorAll('.text-sm.font-light.text-stone-600');
    descriptionTexts.forEach(text => {
      text.style.marginTop = '12px';
    });
  }
  
  // Fix approaches alignment
  function fixApproachesAlignment() {
    // Fix alignment of approach numbers and text
    const approachItems = document.querySelectorAll('.approach-item, .flex.items-start');
    
    approachItems.forEach(item => {
      const number = item.querySelector('.w-6.h-6.rounded-full');
      if (number) {
        number.style.display = 'flex';
        number.style.alignItems = 'center';
        number.style.justifyContent = 'center';
        number.style.minWidth = '24px';
        number.style.textAlign = 'center';
      }
    });
  }
  
  // Remove background color completely
  function removeBackgroundColor() {
    document.body.style.backgroundColor = 'transparent';
    
    const elementsToMakeTransparent = [
      ...document.querySelectorAll('.bg-stone-50'),
      ...document.querySelectorAll('.introduction-section'),
      ...document.querySelectorAll('.assessment-section'),
      ...document.querySelectorAll('.relative.z-20.w-full.max-w-4xl.mx-auto.p-6')
    ];
    
    elementsToMakeTransparent.forEach(el => {
      if (el) el.style.backgroundColor = 'transparent';
    });
  }
  
  // Apply all fixes
  enhanceMasterySection();
  enhanceBackgroundAnimation();
  fixSpectrumDiagramAlignment();
  fixApproachesAlignment();
  removeBackgroundColor();
  
  // Also fix radio button alignment when selectMasteryOption is called
  if (window.selectMasteryOption) {
    const originalSelectMasteryOption = window.selectMasteryOption;
    
    window.selectMasteryOption = function(element, questionId, optionValue) {
      // Call the original function
      originalSelectMasteryOption(element, questionId, optionValue);
      
      // Then fix the alignment
      setTimeout(fixRadioButtonAlignment, 10);
    };
  }
  
  // Apply fixes when Part 2 is shown
  if (window.showPart2) {
    const originalShowPart2 = window.showPart2;
    
    window.showPart2 = function() {
      originalShowPart2();
      
      // Apply fixes after Part 2 is shown
      setTimeout(enhanceMasterySection, 100);
    };
  }
  
  // Handle results section
  if (window.showResults) {
    const originalShowResults = window.showResults;
    
    window.showResults = function() {
      originalShowResults();
      
      // Fix spectrum diagram alignment in results
      setTimeout(fixSpectrumDiagramAlignment, 500);
      setTimeout(fixApproachesAlignment, 500);
    };
  }
  
  console.log("All fixes applied successfully");
});
</script>
  <!-- Additional CSS fix for progress indicator labels -->
<style>
/* Fix overlap between progress indicator labels and visual indicators */
#part2-section .mb-12 .flex.justify-between.text-xs.uppercase.tracking-wider.text-stone-500.mb-2 {
  margin-bottom: 1rem !important; /* Increase space between labels and progress bar */
}

/* Add more space between the progress bar and the content below */
#part2-section .mb-12 {
  margin-bottom: 3rem !important;
}

/* Additional fix for progress bar width */
#progress-fill-part2 {
  transition: width 0.5s ease-in-out;
}
</style>

<!-- Fixed JavaScript for userResponses error -->
<script>
// Wait for the document to fully load
document.addEventListener('DOMContentLoaded', function() {
  // Ensure userResponses object exists
  if (typeof window.userResponses === 'undefined') {
    window.userResponses = {
      typology: {},
      mastery: {}
    };
  } else if (typeof window.userResponses.mastery === 'undefined') {
    window.userResponses.mastery = {};
  }
  
  // Fix for Part 2 Mastery section to show one question at a time
  function enhanceMasterySection() {
    // Get questions container
    const questionsContainer = document.getElementById('mastery-questions');
    if (!questionsContainer) return;
    
    // Get all question containers
    const questions = questionsContainer.querySelectorAll('.question-container');
    if (questions.length === 0) return;
    
    // Hide all questions and only show the first one
    questions.forEach((question, index) => {
      question.style.display = index === 0 ? 'block' : 'none';
      question.classList.toggle('active', index === 0);
    });
    
    // Fix the section number in the circle
    const sectionNumber = document.getElementById('section-number');
    if (sectionNumber) {
      sectionNumber.style.display = 'flex';
      sectionNumber.style.justifyContent = 'center';
      sectionNumber.style.alignItems = 'center';
      sectionNumber.style.width = '100%';
      sectionNumber.style.height = '100%';
    }
    
    // Create navigation buttons if they don't exist
    if (!document.getElementById('next-question-btn')) {
      const navFooter = document.querySelector('#part2-section .mt-16.pt-6.border-t.border-stone-200 .flex.items-center.justify-between');
      
      if (navFooter) {
        // Create next question button
        const nextBtn = document.createElement('button');
        nextBtn.id = 'next-question-btn';
        nextBtn.className = 'group flex items-center text-xs font-medium uppercase tracking-widest text-stone-700';
        nextBtn.innerHTML = `
          Next Question
          <span class="ml-4 h-px w-8 bg-stone-500 group-hover:w-12"></span>
        `;
        
        // Create prev question button
        const prevBtn = document.createElement('button');
        prevBtn.id = 'prev-question-btn';
        prevBtn.className = 'group flex items-center text-xs font-medium uppercase tracking-widest text-stone-400 transition-all hover:text-stone-700';
        prevBtn.style.display = 'none';
        prevBtn.innerHTML = `
          <span class="mr-4 h-px w-8 bg-stone-300 transition-all group-hover:w-12 group-hover:bg-stone-500"></span>
          Previous Question
        `;
        
        // Get navigation elements
        const prevSectionBtn = document.getElementById('prev-section-btn');
        const nextSectionBtn = document.getElementById('next-section-btn');
        
        // Hide next section button initially, will show later
        if (nextSectionBtn) nextSectionBtn.style.display = 'none';
        
        // Insert buttons in appropriate places
        if (prevSectionBtn && prevSectionBtn.parentNode) {
          prevSectionBtn.parentNode.insertBefore(prevBtn, prevSectionBtn);
        }
        
        if (nextSectionBtn && nextSectionBtn.parentNode) {
          nextSectionBtn.parentNode.insertBefore(nextBtn, nextSectionBtn);
        }
        
        // Add current question/total questions indicator
        const questionCounter = document.querySelector('#part2-section .text-xs.font-light.text-stone-500');
        if (questionCounter) {
          const currentSection = parseInt(document.getElementById('current-section').textContent) || 1;
          const totalSections = parseInt(document.getElementById('total-sections').textContent) || 3;
          
          questionCounter.innerHTML = `
            Question <span id="current-question">1</span> of <span id="total-questions">${questions.length}</span> • Section ${currentSection} of ${totalSections}
          `;
        }
        
        // Track current question index
        let currentQuestionIndex = 0;
        
        // Next question button handler
        nextBtn.addEventListener('click', function() {
          // Check if current question is answered
          const currentQuestion = questions[currentQuestionIndex];
          const questionId = currentQuestion.dataset.questionId;
          
          // Safe check for userResponses and mastery
          if (!window.userResponses || !window.userResponses.mastery || !window.userResponses.mastery[questionId]) {
            // Initialize if needed
            if (!window.userResponses) window.userResponses = { typology: {}, mastery: {} };
            if (!window.userResponses.mastery) window.userResponses.mastery = {};
            
            // Check if an option is selected visually but not recorded
            const selectedOption = currentQuestion.querySelector('.bg-amber-50.border-l-2.border-amber-400');
            if (selectedOption && selectedOption.dataset.optionValue) {
              // Record the selection
              window.userResponses.mastery[questionId] = selectedOption.dataset.optionValue;
            } else {
              alert('Please answer the current question before proceeding.');
              return;
            }
          }
          
          // Go to next question
          if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            
            // Update display
            questions.forEach((q, idx) => {
              q.style.display = idx === currentQuestionIndex ? 'block' : 'none';
              q.classList.toggle('active', idx === currentQuestionIndex);
            });
            
            // Update question counter
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            
            // Show/hide navigation buttons
            prevBtn.style.display = 'flex';
            
            if (currentQuestionIndex === questions.length - 1) {
              nextBtn.style.display = 'none';
              nextSectionBtn.style.display = 'flex';
            }
          }
        });
        
        // Previous question button handler
        prevBtn.addEventListener('click', function() {
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            
            // Update display
            questions.forEach((q, idx) => {
              q.style.display = idx === currentQuestionIndex ? 'block' : 'none';
              q.classList.toggle('active', idx === currentQuestionIndex);
            });
            
            // Update question counter
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            
            // Show/hide navigation buttons
            if (currentQuestionIndex === 0) {
              prevBtn.style.display = 'none';
            }
            
            nextBtn.style.display = 'flex';
            nextSectionBtn.style.display = 'none';
          }
        });
      }
    }
  }
  
  // Check for the missing script and add a fix if needed
  function fixMissingScoring() {
    // Check if scoring.js is missing
    if (!window.calculateMasteryScores || !window.determineDominantValues) {
      console.log("Adding fallback scoring functions");
      
      // Fallback implementation for calculateMasteryScores
      window.calculateMasteryScores = function() {
        if (!window.userResponses || !window.userResponses.mastery) {
          return {
            corePriorities: {},
            growthAreas: {},
            alignmentNeeds: {},
            energyPatterns: {}
          };
        }
      
        // Group answers into categories based on question IDs
        const result = {
          corePriorities: {},
          growthAreas: {},
          alignmentNeeds: {},
          energyPatterns: {}
        };
      
        // For each answered question ID → chosen value
        for (const [questionId, chosenValue] of Object.entries(window.userResponses.mastery)) {
          if (questionId.startsWith("core-")) {
            if (!result.corePriorities[chosenValue]) {
              result.corePriorities[chosenValue] = 0;
            }
            result.corePriorities[chosenValue]++;
          } else if (questionId.startsWith("growth-")) {
            if (!result.growthAreas[chosenValue]) {
              result.growthAreas[chosenValue] = 0;
            }
            result.growthAreas[chosenValue]++;
          } else if (questionId.startsWith("alignment-")) {
            if (!result.alignmentNeeds[chosenValue]) {
              result.alignmentNeeds[chosenValue] = 0;
            }
            result.alignmentNeeds[chosenValue]++;
          } else if (questionId.startsWith("energy-")) {
            if (!result.energyPatterns[chosenValue]) {
              result.energyPatterns[chosenValue] = 0;
            }
            result.energyPatterns[chosenValue]++;
          }
        }
      
        return result;
      };
      
      // Fallback implementation for determineDominantValues
      window.determineDominantValues = function(masteryScores) {
        const dominantValues = {
          corePriorities: [],
          growthAreas: [],
          alignmentNeeds: [],
          energyPatterns: []
        };
      
        // Helper function to get dominant values from a score category
        function getDominantValues(scoreCategory) {
          if (Object.keys(scoreCategory).length === 0) {
            return [];
          }
      
          // Find the maximum score
          const maxScore = Math.max(...Object.values(scoreCategory));
      
          // Get all values with the maximum score
          return Object.entries(scoreCategory)
            .filter(([, score]) => score === maxScore)
            .map(([value]) => value);
        }
      
        // Determine the dominant values for each category
        dominantValues.corePriorities = getDominantValues(masteryScores.corePriorities);
        dominantValues.growthAreas = getDominantValues(masteryScores.growthAreas);
        dominantValues.alignmentNeeds = getDominantValues(masteryScores.alignmentNeeds);
        dominantValues.energyPatterns = getDominantValues(masteryScores.energyPatterns);
      
        return dominantValues;
      };
    }
  }
  
  // Apply fixes
  enhanceMasterySection();
  fixMissingScoring();
  
  // Execute on page load
  setTimeout(function() {
    // Ensure progress indicators don't overlap
    const progressLabels = document.querySelector('#part2-section .mb-12 .flex.justify-between.text-xs.uppercase');
    if (progressLabels) {
      progressLabels.style.marginBottom = '1rem';
    }
    
    // Apply fixes again for cases where the page might have been partially loaded
    enhanceMasterySection();
  }, 300);
  
  console.log("Final fixes applied successfully");
});
</script>
</head>
<body>
  <div class="container">
    <!-- Introduction Section -->
    <section class="introduction-section" id="introduction-section">
      <canvas id="intro-background-canvas" class="background-canvas"></canvas>
      
      <div class="introduction">
        <header>
          <div class="flex items-end justify-between mb-16">
            <div>
              <div class="flex items-center">
                <div class="h-px w-12 bg-stone-400 mr-4"></div>
                <span class="text-xs font-medium uppercase tracking-widest text-stone-500">WELCOME</span>
              </div>
              <h1 class="mt-4 text-4xl font-light tracking-tight text-stone-800">REALITY CREATION ASSESSMENT</h1>
              <p class="mt-2 text-sm font-light text-stone-500">A Study in Self-Perception & Personal Architecture</p>
            </div>
          </div>
        </header>
        
        <div class="intro-content">
          <h3>Welcome to Your Reality Creation Journey</h3>
          <p>This assessment is designed to help you understand how you naturally engage with manifestation and reality creation. By exploring your unique patterns, preferences, and priorities, you'll gain insights into your core identity and discover personalized strategies to enhance your manifestation abilities.</p>
          <p>The assessment consists of two interconnected parts:</p>
          <ul>
            <li><strong>Part 1: Reality Creation Typology</strong> - Identifies your natural tendencies across six fundamental spectrums of reality creation.</li>
            <li><strong>Part 2: Mastery Assessment</strong> - Explores your core values, priorities, growth areas, and energetic patterns to provide tailored recommendations.</li>
          </ul>
          <p>Your responses will generate a comprehensive profile with actionable insights specifically designed for your unique energy signature.</p>
          <button id="start-assessment" class="btn">Begin Assessment</button>
        </div>
      </div>
    </section>

    <!-- Part 1: Reality Creation Typology -->
    <section class="assessment-section" id="part1-section" style="display: none;">
      <!-- Canvas for animated background -->
      <canvas id="part1-background-canvas" class="background-canvas"></canvas>
      
      <div class="relative z-20 w-full max-w-4xl mx-auto p-6">
        <!-- Vertical spectrum reference line -->
        <div class="absolute inset-y-0 left-1/2 z-10 w-px -translate-x-1/2 bg-gradient-to-b from-transparent via-stone-300 to-transparent opacity-20"></div>
        
        <!-- Header with spectrum info -->
        <div class="flex items-end justify-between mb-16">
          <div>
            <div class="flex items-center">
              <div class="h-px w-12 bg-stone-400 mr-4"></div>
              <span id="spectrum-counter" class="text-xs font-medium uppercase tracking-widest text-stone-500">SPECTRUM 01/06</span>
            </div>
            <h1 id="spectrum-title" class="mt-4 text-4xl font-light tracking-tight text-stone-800">COGNITIVE ALIGNMENT</h1>
            <p id="spectrum-description" class="mt-2 text-sm font-light text-stone-500">How you mentally interact with reality</p>
          </div>
          <div class="flex flex-col items-end text-xs uppercase tracking-wider mb-1">
            <span class="font-light text-stone-500">REALITY CREATION ASSESSMENT</span>
            <div class="mt-1 flex space-x-2">
              <span class="h-1.5 w-1.5 rounded-full bg-amber-300 opacity-80"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
            </div>
          </div>
        </div>
        
        <!-- Questions container -->
        <div id="spectrum-questions"></div>
        
        <!-- Navigation footer -->
        <div class="mt-16 pt-6 border-t border-stone-200">
          <div class="flex items-center justify-between">
            <button id="prev-spectrum" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-400 transition-all hover:text-stone-700" style="display: none;">
              <span class="mr-4 h-px w-8 bg-stone-300 transition-all group-hover:w-12 group-hover:bg-stone-500"></span>
              Previous
            </button>
            
            <div class="text-xs font-light text-stone-500">
              Question <span id="current-question">1</span> of <span id="total-questions">12</span>
            </div>
            
            <button id="part1-next" class="group flex items-center text-xs font-medium uppercase tracking-widest transition-all text-stone-700">
              Next Spectrum
              <span class="ml-4 h-px w-8 bg-stone-500 group-hover:w-12"></span>
            </button>
          </div>
        </div>
        
        <!-- Abstract progress indicator -->
        <div class="absolute bottom-6 left-1/2 -translate-x-1/2">
          <div id="progress-indicators" class="flex items-center space-x-6">
            <!-- Progress indicators will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Part 2: Mastery Assessment -->
    <section class="assessment-section" id="part2-section" style="display: none;">
      <!-- Canvas for animated background -->
      <canvas id="part2-background-canvas" class="background-canvas"></canvas>
      
      <div class="relative z-20 w-full max-w-4xl mx-auto p-6">
        <!-- Header -->
        <div class="flex items-end justify-between mb-12">
          <div>
            <div class="flex items-center">
              <div class="h-px w-12 bg-stone-400 mr-4"></div>
              <span class="text-xs font-medium uppercase tracking-widest text-stone-500">PART 2 OF 2</span>
            </div>
            <h1 class="mt-4 text-4xl font-light tracking-tight text-stone-800">MASTERY ASSESSMENT</h1>
          </div>
          <div class="flex flex-col items-end text-xs uppercase tracking-wider mb-1">
            <span class="font-light text-stone-500">REALITY CREATION ASSESSMENT</span>
            <div class="mt-1 flex space-x-2">
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-amber-300 opacity-80"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
            </div>
          </div>
        </div>
        
        <!-- Progress indicator -->
        <div class="mb-12">
          <div class="flex justify-between text-xs uppercase tracking-wider text-stone-500 mb-2">
            <span>Core Priorities</span>
            <span>Growth Areas</span>
            <span>Alignment Needs</span>
          </div>
          <div class="h-0.5 w-full bg-stone-200 relative">
            <div id="progress-fill-part2" class="absolute h-full bg-gradient-to-r from-amber-300 to-amber-400 transition-all duration-500" style="width: 33%"></div>
          </div>
        </div>
        
        <!-- Section header -->
        <div class="mb-12">
          <div class="flex items-center mb-2">
            <div class="w-8 h-8 rounded-full flex items-center justify-center bg-amber-50 border border-amber-200">
              <span id="section-number" class="text-xs font-medium text-amber-700">1</span>
            </div>
            <h2 id="section-title" class="ml-4 text-2xl font-light text-stone-800">Core Priorities & Values</h2>
          </div>
          <p id="section-description" class="text-sm font-light text-stone-500 ml-12">
            These questions help identify your deep values and non-negotiable priorities in the manifestation process.
          </p>
        </div>
        
        <!-- Questions container -->
        <div id="mastery-questions"></div>
        
        <!-- Navigation footer -->
        <div class="mt-16 pt-6 border-t border-stone-200">
          <div class="flex items-center justify-between">
            <button id="part2-prev" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-400 transition-all hover:text-stone-700">
              <span class="mr-4 h-px w-8 bg-stone-300 transition-all group-hover:w-12 group-hover:bg-stone-500"></span>
              Back to Part 1
            </button>
            
            <div class="text-xs font-light text-stone-500">
              Section <span id="current-section">1</span> of <span id="total-sections">3</span>
            </div>
            
            <button id="prev-section-btn" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-300 cursor-not-allowed" style="display: none;">
              <span class="mr-4 h-px w-8 bg-stone-200"></span>
              Previous Section
            </button>
            
            <button id="next-section-btn" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-700">
              Next Section
              <span class="ml-4 h-px w-8 bg-stone-500 group-hover:w-12"></span>
            </button>
            
            <button id="submit-assessment" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-700 transition-all hover:text-amber-700" style="display: none;">
              View Results
              <span class="ml-4 h-px w-8 bg-stone-500 transition-all group-hover:w-12 group-hover:bg-amber-500"></span>
            </button>
          </div>
        </div>
        
        <!-- Abstract progress indicator -->
        <div class="absolute bottom-6 left-1/2 -translate-x-1/2">
          <div class="flex items-center space-x-6">
            <div class="h-3 w-px bg-amber-400"></div>
            <div class="h-3 w-px bg-stone-300"></div>
            <div class="h-3 w-px bg-stone-300"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section class="assessment-section" id="results-section" style="display: none;">
      <!-- Canvas for animated background -->
      <canvas id="results-background-canvas" class="background-canvas"></canvas>
      
      <div class="relative z-20 w-full max-w-4xl mx-auto p-6 pt-16 pb-24">
        <!-- Header -->
        <div class="flex items-end justify-between mb-16">
          <div>
            <div class="flex items-center">
              <div class="h-px w-12 bg-stone-400 mr-4"></div>
              <span class="text-xs font-medium uppercase tracking-widest text-stone-500">RESULTS</span>
            </div>
            <h1 class="mt-4 text-4xl font-light tracking-tight text-stone-800">YOUR REALITY CREATION PROFILE</h1>
          </div>
          <div class="flex flex-col items-end text-xs uppercase tracking-wider mb-1">
            <span class="font-light text-stone-500">REALITY CREATION ASSESSMENT</span>
            <div class="mt-1 flex space-x-2">
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-stone-300 opacity-60"></span>
              <span class="h-1.5 w-1.5 rounded-full bg-amber-300 opacity-80"></span>
            </div>
          </div>
        </div>
        
        <!-- Navigation tabs -->
        <div class="tabs-container mb-12 border-b border-stone-200">
          <div class="tab-buttons flex space-x-8" role="tablist">
            <button id="typology-tab" class="tab-button pb-4 text-sm font-light tracking-wide relative text-amber-700" role="tab" aria-selected="true" tabindex="0">
              Reality Creation Typology
              <div class="absolute bottom-0 left-0 w-full h-0.5 bg-amber-400"></div>
            </button>
            <button id="approaches-tab" class="tab-button pb-4 text-sm font-light tracking-wide relative text-stone-500 hover:text-stone-700" role="tab" aria-selected="false" tabindex="-1">
              Ideal Approaches
            </button>
            <button id="strategy-tab" class="tab-button pb-4 text-sm font-light tracking-wide relative text-stone-500 hover:text-stone-700" role="tab" aria-selected="false" tabindex="-1">
              Personalized Strategy
            </button>
          </div>
        </div>
        
        <!-- Results Content -->
        <div class="space-y-16">
          <!-- Typology Tab Content -->
          <div id="typology-content" class="tab-content active" role="tabpanel" aria-labelledby="typology-tab">
            <!-- Typology Pair -->
            <div id="typology-pair" class="typology-results mb-12">
              <!-- This content will be dynamically generated -->
            </div>
            <!-- Spectrum Diagram -->
            <div id="spectrum-diagram" class="spectrum-diagram">
              <!-- This content will be dynamically generated -->
            </div>
          </div>
          
          <!-- Approaches Tab Content -->
          <div id="approaches-content" class="tab-content" role="tabpanel" aria-labelledby="approaches-tab" style="display: none;">
            <!-- Ideal Approaches -->
            <div id="ideal-approaches" class="ideal-approaches space-y-8">
              <!-- This content will be dynamically generated -->
            </div>
            <!-- Common Misalignments -->
            <div id="common-misalignments" class="common-misalignments mt-12">
              <!-- This content will be dynamically generated -->
            </div>
          </div>
          
          <!-- Strategy Tab Content -->
          <div id="strategy-content" class="tab-content" role="tabpanel" aria-labelledby="strategy-tab" style="display: none;">
            <!-- Mastery Priorities -->
            <div id="mastery-priorities" class="mastery-priorities space-y-8">
              <!-- This content will be dynamically generated -->
            </div>
            <!-- Prescriptive Strategy -->
            <div id="prescriptive-strategy" class="prescriptive-strategy mt-12">
              <!-- This content will be dynamically generated -->
            </div>
          </div>
        </div>
        
        <!-- Footer navigation -->
        <div class="mt-16 pt-6 border-t border-stone-200">
          <div class="flex items-center justify-between">
            <button id="restart-assessment" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-400 transition-all hover:text-stone-700">
              <span class="mr-4 h-px w-8 bg-stone-300 transition-all group-hover:w-12 group-hover:bg-stone-500"></span>
              Retake Assessment
            </button>
            <button id="print-results" class="group flex items-center text-xs font-medium uppercase tracking-widest text-stone-700 transition-all hover:text-amber-700">
              Download PDF
              <span class="ml-4 h-px w-8 bg-stone-500 transition-all group-hover:w-12 group-hover:bg-amber-500"></span>
            </button>
          </div>
        </div>
        
        <!-- Abstract progress indicator -->
        <div class="absolute bottom-6 left-1/2 -translate-x-1/2">
          <div class="flex items-center space-x-6">
            <div class="h-3 w-px bg-stone-300"></div>
            <div class="h-3 w-px bg-stone-300"></div>
            <div class="h-3 w-px bg-amber-400"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="js/redesigned-animations.js"></script>
  <script src="js/redesigned-assessment.js"></script>
  <script src="js/redesigned-part2-mastery.js"></script>
  <script src="js/redesigned-scoring.js"></script>
  <script src="js/redesigned-results.js"></script>
  <!-- Add this directly to your index.html file before the closing </body> tag -->
<script>
// Wait for document to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
  // ===== FIX 1: Progress indicator text overlap =====
  // Apply immediate CSS fixes for spacing
  const styleElement = document.createElement('style');
  styleElement.textContent = `
    /* Fix overlap between progress indicator labels and visual indicators */
    #part2-section .mb-12 .flex.justify-between.text-xs.uppercase.tracking-wider.text-stone-500 {
      margin-bottom: 24px !important; /* Increase space significantly */
    }
    
    /* Add more space between the progress bar and the content below */
    #part2-section .mb-12 {
      margin-bottom: 48px !important;
    }
    
    /* Ensure progress bar is visible */
    #progress-fill-part2 {
      height: 100% !important;
      background-image: linear-gradient(to right, #fcd34d, #fbbf24) !important;
    }
  `;
  document.head.appendChild(styleElement);
  
  // ===== FIX 2: Next Question button fix =====
  function fixNextQuestionButton() {
    // First, ensure userResponses object exists globally
    if (typeof window.userResponses === 'undefined') {
      window.userResponses = {
        typology: {},
        mastery: {}
      };
    }
    
    // Override selectMasteryOption to make sure it properly logs responses
    if (typeof window.selectMasteryOption === 'function') {
      const originalSelectMasteryOption = window.selectMasteryOption;
      
      window.selectMasteryOption = function(element, questionId, optionValue) {
        // Store the selection properly in userResponses
        if (!window.userResponses.mastery) {
          window.userResponses.mastery = {};
        }
        
        // Record the answer
        window.userResponses.mastery[questionId] = optionValue;
        console.log(`Stored answer for ${questionId}: ${optionValue}`);
        
        // Call original function for UI updates
        originalSelectMasteryOption(element, questionId, optionValue);
      };
    }
    
    // Create a simple direct replacement for the Next Question button functionality
    function createNewNextQuestionButton() {
      const nextBtn = document.getElementById('next-question-btn');
      if (!nextBtn) return;
      
      // Clone the button to remove old event listeners
      const newNextBtn = nextBtn.cloneNode(true);
      nextBtn.parentNode.replaceChild(newNextBtn, nextBtn);
      
      // Add our custom event handler
      newNextBtn.addEventListener('click', function() {
        const questions = document.querySelectorAll('#mastery-questions .question-container');
        const currentQuestion = Array.from(questions).find(q => q.style.display !== 'none');
        
        if (!currentQuestion) return;
        
        const questionId = currentQuestion.dataset.questionId;
        
        // Check if the current question has a visually selected option
        const selectedOption = currentQuestion.querySelector('.bg-amber-50.border-l-2.border-amber-400');
        if (selectedOption) {
          // Get option value from the selected element
          const optionValue = selectedOption.dataset.optionValue;
          
          // Double-check that we store this properly
          if (!window.userResponses.mastery) {
            window.userResponses.mastery = {};
          }
          window.userResponses.mastery[questionId] = optionValue;
          
          // Find the next question
          let currentIndex = Array.from(questions).indexOf(currentQuestion);
          
          if (currentIndex < questions.length - 1) {
            // Hide current question
            currentQuestion.style.display = 'none';
            
            // Show next question
            const nextQuestion = questions[currentIndex + 1];
            nextQuestion.style.display = 'block';
            
            // Update question counter
            const counter = document.getElementById('current-question');
            if (counter) counter.textContent = currentIndex + 2;
            
            // Show previous question button
            const prevBtn = document.getElementById('prev-question-btn');
            if (prevBtn) prevBtn.style.display = 'flex';
            
            // Hide next question button and show next section button on last question
            if (currentIndex + 1 >= questions.length - 1) {
              newNextBtn.style.display = 'none';
              const nextSectionBtn = document.getElementById('next-section-btn');
              if (nextSectionBtn) nextSectionBtn.style.display = 'flex';
            }
          }
        } else {
          alert('Please answer the current question before proceeding.');
        }
      });
      
      // Also fix the Previous Question button
      const prevBtn = document.getElementById('prev-question-btn');
      if (prevBtn) {
        const newPrevBtn = prevBtn.cloneNode(true);
        prevBtn.parentNode.replaceChild(newPrevBtn, prevBtn);
        
        newPrevBtn.addEventListener('click', function() {
          const questions = document.querySelectorAll('#mastery-questions .question-container');
          const currentQuestion = Array.from(questions).find(q => q.style.display !== 'none');
          
          if (!currentQuestion) return;
          
          // Find the previous question
          let currentIndex = Array.from(questions).indexOf(currentQuestion);
          
          if (currentIndex > 0) {
            // Hide current question
            currentQuestion.style.display = 'none';
            
            // Show previous question
            const prevQuestion = questions[currentIndex - 1];
            prevQuestion.style.display = 'block';
            
            // Update question counter
            const counter = document.getElementById('current-question');
            if (counter) counter.textContent = currentIndex;
            
            // Hide previous button on first question
            if (currentIndex - 1 === 0) {
              newPrevBtn.style.display = 'none';
            }
            
            // Show next question button, hide next section button
            newNextBtn.style.display = 'flex';
            const nextSectionBtn = document.getElementById('next-section-btn');
            if (nextSectionBtn) nextSectionBtn.style.display = 'none';
          }
        });
      }
    }
    
    // Wait for necessary elements to be present
    const waitForElements = setInterval(function() {
      const nextBtn = document.getElementById('next-question-btn');
      const questions = document.querySelectorAll('#mastery-questions .question-container');
      
      if (nextBtn && questions.length > 0) {
        clearInterval(waitForElements);
        createNewNextQuestionButton();
        console.log("Next/Previous question buttons have been fixed");
      }
    }, 500);
  }
  
  // Apply fixes when Part 2 is shown
  const fixForPart2 = function() {
    // Fix navigation between mastery questions
    const part2Section = document.getElementById('part2-section');
    if (part2Section && part2Section.style.display !== 'none') {
      setTimeout(fixNextQuestionButton, 500);
    }
  };
  
  // Listen for clicks on elements that might show Part 2
  document.addEventListener('click', function(event) {
    if (event.target.id === 'part1-next' || 
        event.target.matches('#part1-next *') ||
        event.target.id === 'next-section-btn' ||
        event.target.matches('#next-section-btn *')) {
      setTimeout(fixForPart2, 500);
    }
  });
  
  // Also apply the fix if Part 2 is already being shown
  if (document.getElementById('part2-section') && 
      document.getElementById('part2-section').style.display !== 'none') {
    fixForPart2();
  }
  
  // MutationObserver to watch for changes in visibility
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.target.id === 'part2-section' && 
          mutation.attributeName === 'style' &&
          mutation.target.style.display !== 'none') {
        fixForPart2();
      }
    });
  });
  
  const part2Section = document.getElementById('part2-section');
  if (part2Section) {
    observer.observe(part2Section, { attributes: true });
  }
  
  console.log("All fixes have been applied successfully");
});
</script>
</body>
</html>
